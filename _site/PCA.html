<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>主成分分析（PCA） | liubaojie_test</title>
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="stylesheet" href="/css/font-awesome/css/font-awesome.min.css" type="text/css" />
  <link rel="stylesheet" href="/css/default.css" type="text/css" />
  <link rel="stylesheet" href="/css/desktop.css" type="text/css" />
  <link rel="stylesheet" href="/css/mobile.css" type="text/css" />
  <link rel="shortcut icon" href="/css/favicon.ico" type="image/x-icon" />
  <link rel="icon" href="/css/favicon.ico" mce_href="/favicon.ico" type="image/x-icon">
  <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
  <script src="/js/jquery-1.11.0.min.js" type="text/javascript"></script>
  <script src="/js/jquery-migrate-1.2.1.js" type="text/javascript"></script>
  <script src="/js/jquery.transit.min.js" type="text/javascript"></script>
  <script src="/js/common.js" type="text/javascript"></script>

<body>
  <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
  html {
    background: #333333;
    -webkit-background-size: cover;
    -moz-background-size: cover;
    -o-background-size: cover;
    background-size: cover;
  }
  @media screen and (max-width: 750px){
    body { background: rgba(255, 255, 255, 0.9); }
  }
</style>

<div id="content" class="post" style="margin-top: 20px;">
  <div id="avatar" class="avatar circle" data-in-right="false" style="width: 150px; height: 150px; position: fixed; top: 40px; z-index: 99; opacity: 0;">
    <div class="center" style="margin-top: 4px; height: 142px; width: 142px; border-radius: 71px; background-image: url('../images/user.png');"></div>
  </div>

  <div class="entry" style="position: relative;">
    <h1 class="entry-title"><a href="/PCA" title="主成分分析（PCA）">主成分分析（PCA）</a></h1>

    <p class="entry-date">2016-05-23 
        <span class="lastModified" style="display: none;" data-source="_posts/learn/2016-05-23-PCA.md">最后更新时间: 
        </span>
    </p>


    <h1 id="pca">主成分分析（PCA）</h1>

<blockquote>
  <p>主成分分析（PCA）是一种数据降维技巧，它能将大量相关变量转化为一组很少的不相关变
量，这些无关变量称为主成分。</p>
</blockquote>

<p><img src="images/PCA1.png" alt="image" /></p>

<p>PCA和EFA最常见的步骤如下：</p>

<ol>
  <li><strong>数据预处理</strong>。可以输入原始数据矩阵或者相关系数矩阵到<code class="highlighter-rouge">principal()</code>和<code class="highlighter-rouge">fa()</code>函数中。输入初始数据，相关系数矩阵将会被自动计算，需要确保数据中没有缺失值。</li>
  <li><strong>选择因子模型</strong>。判断<strong>PCA(数据降维)</strong>还是<strong>EFA(发现潜在结构)</strong>更符合你的研究目的。</li>
</ol>

<p><strong>PCA</strong>的目标是用一组较少的不相关变量代替大量相关变量，同时尽可能保留初始变量的信息。如第一主成分为：</p>

<p><span title="MathGene HTML" style="font-family:Times,Serif;font-size:100%"><i>P</i><i>C</i><sub><sub>1</sub></sub> = <i>a</i><sub><sub>1</sub></sub><i>X</i><sub><sub>1</sub></sub>+<i>a</i><sub><sub>2</sub></sub><i>X</i><sub><sub>2</sub></sub>+…+<i>a</i><sub><sub><i>k</i></sub></sub><i>X</i><sub><sub><i>k</i></sub></sub></span></p>

<p>它是k个观测变量的加权组合，对初始变量集的方差解释性<strong>最大</strong>。第二主成分也是初始变量的线性组合，对方差的解释性排<strong>第二</strong>，同时与第一主成分<strong>正交</strong>（不相关）。</p>

<p>PCA的目标是找到一个满足如下性质的数据变换：</p>

<ol>
  <li>每对(不同的)新属性的协方差为0；</li>
  <li>属性按照每个属性捕获的方差多少来排序；</li>
  <li>每一个属性捕获尽可能多的数据方差。</li>
  <li>在满足正交的前提下，每个后继属性捕获尽可能多的剩余方差。</li>
</ol>

<p>假设存在数据集D，令其协方差矩阵为S，将S的特征值排序，U是S的特征向量矩阵，最后假设已经对数据矩阵D进行过预处理，使得每个属性(列)的均值为0，则有：</p>

<ul>
  <li>数据矩阵D’=DU是变换后的数据集，满足以上条件。</li>
  <li>每个新属性都是原属性的线性组合。</li>
  <li>第i个新属性的方差就是S的第i个特征值。</li>
  <li>原属性的方差和等于新属性的方差和。</li>
</ul>

<h2 id="section">判断主成分的个数</h2>

<p>一些准则：
- 根据先验经验和理论知识判断主成分数；
- 根据要解释变量方差的积累值的阈值来判断需要的主成分数；
- 通过检查变量间k × k的相关系数矩阵来判断保留的主成分数。</p>

<p><img src="images/PCA2.png" alt="image" /></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">psych</span><span class="p">)</span><span class="w">
</span><span class="n">fa.parallel</span><span class="p">(</span><span class="n">USJudgeRatings</span><span class="p">[,</span><span class="m">-1</span><span class="p">],</span><span class="n">fa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pc"</span><span class="p">,</span><span class="n">n.iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Scree plot with parallel analysis"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
<p>表明选择一个主成分即可保留数据集的大部分信息。</p>

<h2 id="section-1">提取主成分</h2>

<p>美国法官评分的主成分分析的例子：</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">psych</span><span class="p">)</span><span class="w">
</span><span class="n">pc</span><span class="o">&lt;-</span><span class="n">principal</span><span class="p">(</span><span class="n">USJudgeRatings</span><span class="p">[,</span><span class="m">-1</span><span class="p">],</span><span class="n">nfactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">pc</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>$output
Principal Components Analysis
Call: principal(r = USJudgeRatings[, -1], nfactors = 1)
Standardized loadings (pattern matrix) based upon correlation matrix
      PC1   h2     u2 com
INTG 0.92 0.84 0.1565   1
DMNR 0.91 0.83 0.1663   1
DILG 0.97 0.94 0.0613   1
CFMG 0.96 0.93 0.0720   1
DECI 0.96 0.92 0.0763   1
PREP 0.98 0.97 0.0299   1
FAMI 0.98 0.95 0.0469   1
ORAL 1.00 0.99 0.0091   1
WRIT 0.99 0.98 0.0196   1
PHYS 0.89 0.80 0.2013   1
RTEN 0.99 0.97 0.0275   1

                 PC1
SS loadings    10.13
Proportion Var  0.92
</code></pre>
</div>

<p>此处可以看到，第一主成分（PC1）与每个变量都高度相关，也就是说，它是一个可以用来进行一般性评价的难度。<br />
h2栏指成分<strong>公因子方差</strong>——主成分对每个变量方差的解释度。u2是成分<strong>唯一性</strong>——方差无法被主成分解释的比例（1-h2）。例如，体能（PHYS）80%的方差都能由第一主成分来解释，20%不能。<br />
Proportion Var行表示的是每个主成分对整个数据集的解释程度。此处可以看到，第一主成分解释了11个变量92%的方差。</p>

<h2 id="section-2">主成分旋转</h2>
<p>旋转可以用来<strong>去噪</strong>。旋转方法有两种：使选择的成分保持不变（<strong>正交旋转</strong>），和让他们变得相关（<strong>斜交旋转</strong>）。最流行的正交旋转是<strong>方差极大</strong>旋转。</p>

<p>例子：</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">rc</span><span class="o">&lt;-</span><span class="n">principal</span><span class="p">(</span><span class="n">Harman23.cor</span><span class="o">$</span><span class="n">cov</span><span class="p">,</span><span class="n">nfactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="n">rotate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"varimax"</span><span class="p">)</span><span class="w">
</span><span class="n">rc</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>$output
Principal Components Analysis
Call: principal(r = Harman23.cor$cov, nfactors = 2, rotate = "varimax")
Standardized loadings (pattern matrix) based upon correlation matrix
                PC1  PC2   h2    u2 com
height         0.90 0.25 0.88 0.123 1.2
arm.span       0.93 0.19 0.90 0.097 1.1
forearm        0.92 0.16 0.87 0.128 1.1
lower.leg      0.90 0.22 0.86 0.139 1.1
weight         0.26 0.88 0.85 0.150 1.2
bitro.diameter 0.19 0.84 0.74 0.261 1.1
chest.girth    0.11 0.84 0.72 0.283 1.0
chest.width    0.26 0.75 0.62 0.375 1.2

                       PC1  PC2
SS loadings           3.52 2.92
Proportion Var        0.44 0.37
Cumulative Var        0.44 0.81
</code></pre>
</div>
<p>观察输出，发现第一主成分主要由前四个变量来解释，第二个主成分则由后四个变量来解释。两个主成分仍然不相关，对变量的解释性不变。</p>



  </div>


  <div id="menuIndex" class="sidenav">
    <div class="myinfo"><center>
      <div id="avatarHolder" class="avatar circle" style="width: 0px; height: 0px; box-shadow: none; margin-bottom: 20px;"></div>
      <a href="/index.html" title="Homepage"><i class="icon-home icon-large"></i> Home</a>
      <a href="http://www.linkedin.com/in"><i class="icon-linkedin-sign icon-large"></i> Profile</a>
      <a href="https://github.com/"><i class="icon-github icon-large"></i> Code</a>
      <a href="mailto:liubaojie2016@163.com"><i class="icon-envelope icon-large"></i> Mail</a>
    </center></div>
    <div id="menu"></div>
  </div>
</div>

<script src="/js/post.js" type="text/javascript"></script>

</body>
</html>
