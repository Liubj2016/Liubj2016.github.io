<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>协整的配对交易 | liubaojie's site</title>
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="stylesheet" href="/css/font-awesome/css/font-awesome.min.css" type="text/css" />
  <link rel="stylesheet" href="/css/default.css" type="text/css" />
  <link rel="stylesheet" href="/css/desktop.css" type="text/css" />
  <link rel="stylesheet" href="/css/mobile.css" type="text/css" />
  <link rel="shortcut icon" href="/css/favicon.ico" type="image/x-icon" />
  <link rel="icon" href="/css/favicon.ico" mce_href="/favicon.ico" type="image/x-icon">
  <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
  <script src="/js/jquery-1.11.0.min.js" type="text/javascript"></script>
  <script src="/js/jquery-migrate-1.2.1.js" type="text/javascript"></script>
  <script src="/js/jquery.transit.min.js" type="text/javascript"></script>
  <script src="/js/common.js" type="text/javascript"></script>

<body>
  <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
  html {
    background: #333333;
    -webkit-background-size: cover;
    -moz-background-size: cover;
    -o-background-size: cover;
    background-size: cover;
  }
  @media screen and (max-width: 750px){
    body { background: rgba(255, 255, 255, 0.9); }
  }
</style>

<div id="content" class="post" style="margin-top: 20px;">
  <div id="avatar" class="avatar circle" data-in-right="false" style="width: 150px; height: 150px; position: fixed; top: 40px; z-index: 99; opacity: 0;">
    <div class="center" style="margin-top: 4px; height: 142px; width: 142px; border-radius: 71px; background-image: url('../images/user.png');"></div>
  </div>

  <div class="entry" style="position: relative;">
    <h1 class="entry-title"><a href="/cointergration" title="协整的配对交易">协整的配对交易</a></h1>

    <p class="entry-date">2016-07-09 
        <span class="lastModified" style="display: none;" data-source="_posts/learn/2016-07-09-cointergration.md">最后更新时间: 
        </span>
    </p>


    <p>统计套利的配对交易就是基于数学分析的交易策略，利用两只证券的价差（spread）来获取套利机会。价差具有一定关系的两只证券可能存在协整关系（cointegration）。</p>

<p>协整关系存在的条件是：只有当两个变量的时间序列{x}和{y}是同阶单整序列即I(d)时，才可能存在协整关系(这一点对多变量协整并不适用)。因此在进行y和x两个变量协整关系检验之前，先用ADF单位根检验对两时间序列{x}和{y}进行平稳性检验。用单位根检验（ADF）。</p>

<p>这里选取北京银行和交通银行来做研究。</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> 
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">beginDate</span><span class="o">=</span><span class="s">"2013-01-01"</span>
<span class="n">endDate</span><span class="o">=</span><span class="s">"2014-01-01"</span>
<span class="n">data1</span><span class="o">=</span><span class="n">get_price</span><span class="p">(</span><span class="s">"601169.XSHG"</span><span class="p">,</span><span class="n">start_date</span><span class="o">=</span><span class="n">beginDate</span><span class="p">,</span><span class="n">end_date</span><span class="o">=</span><span class="n">endDate</span><span class="p">,</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s">'close'</span><span class="p">],</span><span class="n">frequency</span><span class="o">=</span><span class="s">'daily'</span><span class="p">)</span>
<span class="n">data2</span><span class="o">=</span><span class="n">get_price</span><span class="p">(</span><span class="s">"601328.XSHG"</span><span class="p">,</span><span class="n">start_date</span><span class="o">=</span><span class="n">beginDate</span><span class="p">,</span><span class="n">end_date</span><span class="o">=</span><span class="n">endDate</span><span class="p">,</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s">'close'</span><span class="p">],</span><span class="n">frequency</span><span class="o">=</span><span class="s">'daily'</span><span class="p">)</span>

<span class="n">z</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data1</span><span class="p">,</span><span class="n">data2</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">z</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'BJYH'</span><span class="p">,</span><span class="s">'JTYH'</span><span class="p">]</span>
<span class="n">z</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fec21774390&gt;
</code></pre>
</div>

<p><img src="images/output_xz.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="k">def</span> <span class="nf">testStationarity</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">adftest</span><span class="o">=</span><span class="n">adfuller</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">result</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">adftest</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s">'Test Statistics'</span><span class="p">,</span><span class="s">'p-value'</span><span class="p">,</span><span class="s">'Lags Used'</span><span class="p">,</span><span class="s">'Number of Observation Used'</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">adftest</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">result</span><span class="p">[</span><span class="s">'Critical Value (</span><span class="si">%</span><span class="s">s)'</span><span class="o">%</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">return</span> <span class="n">result</span>
<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span>
<span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">zz</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">testStationarity</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">testStationarity</span><span class="p">(</span><span class="n">y</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">zz</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'BJYH'</span><span class="p">,</span><span class="s">'JTYH'</span><span class="p">]</span>
<span class="n">zz</span>
</code></pre>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BJYH</th>
      <th>JTYH</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test Statistics</th>
      <td>-2.065881</td>
      <td>-1.740105</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.258454</td>
      <td>0.410576</td>
    </tr>
    <tr>
      <th>Lags Used</th>
      <td>0.000000</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>Number of Observation Used</th>
      <td>237.000000</td>
      <td>233.000000</td>
    </tr>
    <tr>
      <th>Critical Value (5%)</th>
      <td>-2.873814</td>
      <td>-2.874026</td>
    </tr>
    <tr>
      <th>Critical Value (1%)</th>
      <td>-3.458247</td>
      <td>-3.458731</td>
    </tr>
    <tr>
      <th>Critical Value (10%)</th>
      <td>-2.573311</td>
      <td>-2.573424</td>
    </tr>
  </tbody>
</table>
</div>

<p>p值不显著，说明接受原假设，即存在单位根。下面做一阶差分以后，再检验平稳性。</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">diffone</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">Diff</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Diff</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">Diff</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Diff</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Diff</span>
<span class="n">diffx</span><span class="o">=</span><span class="n">diffone</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span>
<span class="n">diffy</span><span class="o">=</span><span class="n">diffone</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
<span class="n">tz</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">testStationarity</span><span class="p">(</span><span class="n">diffx</span><span class="p">),</span><span class="n">testStationarity</span><span class="p">(</span><span class="n">diffy</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">tz</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'BJYH'</span><span class="p">,</span><span class="s">'JTYH'</span><span class="p">]</span>
<span class="n">tz</span>
</code></pre>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BJYH</th>
      <th>JTYH</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test Statistics</th>
      <td>-1.676017e+01</td>
      <td>-6.075262e+00</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>1.312152e-29</td>
      <td>1.125575e-07</td>
    </tr>
    <tr>
      <th>Lags Used</th>
      <td>0.000000e+00</td>
      <td>5.000000e+00</td>
    </tr>
    <tr>
      <th>Number of Observation Used</th>
      <td>2.360000e+02</td>
      <td>2.310000e+02</td>
    </tr>
    <tr>
      <th>Critical Value (5%)</th>
      <td>-2.873866e+00</td>
      <td>-2.874135e+00</td>
    </tr>
    <tr>
      <th>Critical Value (1%)</th>
      <td>-3.458366e+00</td>
      <td>-3.458980e+00</td>
    </tr>
    <tr>
      <th>Critical Value (10%)</th>
      <td>-2.573339e+00</td>
      <td>-2.573482e+00</td>
    </tr>
  </tbody>
</table>
</div>

<p>现在的p值很显著，也就是说可以拒绝原假设，即不存在单位根，序列平稳。</p>

<p>既然他们都是一阶平稳的，那么现在就可以做协整检验了。</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">coint</span>
<span class="n">a</span><span class="p">,</span><span class="n">pvalue</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">coint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="n">pvalue</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>0.00102528244038
</code></pre>
</div>

<p>p值显著，可以拒绝原假设，则两者存在协整关系。</p>

<p>接下来可以根据两者的协整关系做配对交易了。</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="n">data1</span><span class="o">-</span><span class="n">data2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">std</span><span class="o">=</span><span class="p">(</span><span class="n">data1</span><span class="o">-</span><span class="n">data2</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">s1</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">data1</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">s2</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">std</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">data1</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">s3</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">std</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">data1</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">data3</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data1</span><span class="o">-</span><span class="n">data2</span><span class="p">,</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">,</span><span class="n">s3</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data3</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'spread'</span><span class="p">,</span><span class="s">'mean'</span><span class="p">,</span><span class="s">'upper'</span><span class="p">,</span><span class="s">'down'</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">std</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mean</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">std</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">data3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>1.7175819797 1.43771213795





&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fec16f93978&gt;
</code></pre>
</div>

<p><img src="images/output_xz_2.png" alt="png" /></p>

<p>策略的话，简单的策略就是价差超过upper的时候卖空价差，即卖出北京银行，买入交通银行；价差小于down的时候，买入价差，即买入交通银行，卖空北京银行。</p>



  </div>


  <div id="menuIndex" class="sidenav">
    <div class="myinfo"><center>
      <div id="avatarHolder" class="avatar circle" style="width: 0px; height: 0px; box-shadow: none; margin-bottom: 20px;"></div>
      <a href="/index.html" title="Homepage"><i class="icon-home icon-large"></i> Home</a>
      <a href="http://www.linkedin.com/in"><i class="icon-linkedin-sign icon-large"></i> Profile</a>
      <a href="https://github.com/"><i class="icon-github icon-large"></i> Code</a>
      <a href="mailto:liubaojie2016@163.com"><i class="icon-envelope icon-large"></i> Mail</a>
    </center></div>
    <div id="menu"></div>
  </div>
</div>

<script src="/js/post.js" type="text/javascript"></script>


<!-- 多说评论框 start -->


</body>


</html>
